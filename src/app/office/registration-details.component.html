<a class="float-right" [routerLink]="['..']">&larr; zurück</a>
<spinner *ngIf="reg == null"></spinner>

<div *ngIf="reg != null">
  <h2>{{reg.child.firstName}} {{reg.child.lastName}}</h2>
  <p>Angemeldet am {{ reg.registeredAt | date }}</p>

  <div class="alert alert-danger" *ngIf="!reg.payment || !reg.waiver">
    <strong>Die Anmeldung ist noch nicht vollständig:</strong>
    <ul class="mb-0">
      <li *ngIf="!reg.payment">Teilnahmebeitrag fehlt: € {{ reg.price.total | number:'1.2-2' }}.</li>
      <li *ngIf="!reg.waiver">Einverständniserklärung fehlt.</li>
    </ul>
  </div>

  <div class="row">
    <div class="col-lg-6 mb-3">
      <div class="card" [ngClass]="{ 'border-danger': !reg.payment }">
        <div class="card-body">
          <h3 class="card-title">Teilnahmebeitrag € {{ reg.price.total | number:'1.2-2' }}</h3>
          <div *ngIf="reg.payment">
            <p class="card-text">Wir haben Ihren Teilnahmebeitrag am {{ reg.payment.timestamp | date }} erhalten. Vielen Dank!</p>
            <div *ngIf="user && user.hasRole('office')" class="mt-3">
              <button class="btn btn-primary" (click)="setPaymentReceived(false)">
                <i class="fa fa-times mr-1" aria-hidden="true"></i>
                Teilnahmebeitrag doch nicht erhalten
              </button>
            </div>
          </div>
          <div *ngIf="!reg.payment">
            <p class="card-text text-danger">Wir haben Ihren Teilnahmebeitrag noch nicht erhalten.</p>
            <div *ngIf="user && user.hasRole('office')" class="mt-3">
              <button class="btn btn-primary" (click)="setPaymentReceived(true)">
                <i class="fa fa-check mr-1" aria-hidden="true"></i>
                Teilnahmebeitrag erhalten
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-6 mb-3">
      <div class="card" [ngClass]="{ 'border-danger': !reg.waiver }">
        <div class="card-body">
          <h3 class="card-title">Einverständniserklärung</h3>
          <div *ngIf="reg.waiver">
            <p class="card-text">Wir haben Ihre Einverständniserklärung am {{ reg.waiver.timestamp | date }} erhalten.</p>
            <div *ngIf="user && user.hasRole('office')" class="mt-3">
              <button class="btn btn-primary" (click)="setWaiverReceived(false)">
                <i class="fa fa-times mr-1" aria-hidden="true"></i>
                Einverständniserklärung doch nicht erhalten
              </button>
            </div>
          </div>
          <div *ngIf="!reg.waiver">
            <p class="card-text text-danger">Wir haben Ihre Einverständniserklärung noch nicht erhalten.</p>
            <button class="btn btn-primary mt-3" (click)="printWaiver()">
              <spinner inverse class="mr-3" *ngIf="waiverWorking"></spinner>
              <i class="fa fa-print mr-1" aria-hidden="true" *ngIf="!waiverWorking"></i>
              Einverständniserklärung drucken
            </button>
            <div *ngIf="user && user.hasRole('office')" class="mt-3">
              <button class="btn btn-primary" (click)="setWaiverReceived(true)">
                <i class="fa fa-check mr-1" aria-hidden="true"></i>
                Einverständniserklärung erhalten
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="user && user.hasRole('office')" class="mt-5">
    <div class="row">
      <div class="col-lg-6">
        <h4>Kind</h4>
        <dl class="row">
          <dt class="col-sm-3">Geburtsdatum</dt><dd class="col-sm-9">{{ reg.child.dateOfBirth | date }}</dd>
          <dt class="col-sm-3">Geschlecht</dt><dd class="col-sm-9">{{ reg.child.gender.label }}</dd>
          <dt class="col-sm-3">T-Shirt</dt><dd class="col-sm-9">{{ reg.child.shirtSize.label }}</dd>
          <dt class="col-sm-3">Vegetarisch</dt><dd class="col-sm-9">{{ reg.child.vegetarian ? 'ja' : 'nein' }}</dd>
          <dt class="col-sm-3">Geschwister</dt><dd class="col-sm-9">{{ reg.child.nextChild ? 'ja' : 'nein' }}</dd>
        </dl>
      </div>
      <div class="col-lg-6">
        <h4>Erziehungsberechtigte(r)</h4>
        <dl class="row">
          <dt class="col-sm-3">Telefon</dt><dd class="col-sm-9"><a href="tel:{{ reg.parent.phone }}">{{ reg.parent.phone }}</a></dd>
          <dt class="col-sm-3">Email</dt><dd class="col-sm-9"><a href="mailto:{{ reg.parent.email }}">{{ reg.parent.email }}</a></dd>
          <dt class="col-sm-3">Adresse</dt><dd class="col-sm-9">{{ reg.parent.street }}<br>{{ reg.parent.plz }} {{ reg.parent.city }}</dd>
        </dl>
        <h4>Notfallkontakt</h4>
        <dl class="row">
          <dt class="col-sm-3">Name</dt><dd class="col-sm-9">{{ reg.emergencyContact.name }}</dd>
          <dt class="col-sm-3">Telefon</dt><dd class="col-sm-9"><a href="tel:{{ reg.emergencyContact.phone }}">{{ reg.emergencyContact.phone }}</a></dd>
        </dl>
      </div>
    </div>
  </div>
</div>
